<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰µè–¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #5e3391;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tutorial {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #2196F3;
        }

        .tutorial h3 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .status-item {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }

        .status-item:hover {
            transform: translateY(-2px);
        }

        .status-item h3 {
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .status-item p {
            font-size: 1.3em;
            font-weight: bold;
        }

        .phase-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .phase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .phase-title {
            font-size: 1.5em;
            color: #5e3391;
        }

        .phase-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .phase-status.active {
            background: #4CAF50;
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .phase-status.completed {
            background: #2196F3;
            color: white;
        }

        .phase-status.locked {
            background: #9E9E9E;
            color: white;
        }

        .phase-description {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #5e3391;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9em;
            font-weight: bold;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .action-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .action-card:hover:not(.disabled) {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }

        .action-card.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .action-card h4 {
            color: #5e3391;
            margin-bottom: 10px;
        }

        .action-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .action-detail {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #FF9800 0%, #FFC107 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #36D1DC 0%, #5B86E5 100%);
            color: white;
        }

        .event-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .event-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .event-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .event-icon {
            font-size: 4em;
            margin-bottom: 10px;
        }

        .event-title {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 10px;
        }

        .event-description {
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .event-effects {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .effect-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .effect-positive {
            color: #4CAF50;
        }

        .effect-negative {
            color: #f44336;
        }

        .message-log {
            background: #333;
            color: #0f0;
            padding: 15px;
            border-radius: 10px;
            height: 180px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin-top: 20px;
        }

        .message {
            margin-bottom: 5px;
            animation: fadeIn 0.5s;
        }

        .message.event {
            color: #ffeb3b;
            font-weight: bold;
        }

        .message.success {
            color: #4CAF50;
        }

        .message.warning {
            color: #ff9800;
        }

        .message.error {
            color: #f44336;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .phase-summary {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #4CAF50;
        }

        .phase-summary h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            font-size: 0.9em;
            color: #666;
        }

        .summary-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #2e7d32;
        }

        .game-over {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            color: white;
            margin-top: 20px;
        }

        .game-over h2 {
            font-size: 2em;
            margin-bottom: 15px;
        }

        .restart-btn {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            .status-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ§ª å‰µè–¬ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ Advanced ğŸ§¬</h1>
        
        <div class="tutorial" id="tutorial">
            <h3>ğŸ“š ã‚²ãƒ¼ãƒ è§£èª¬</h3>
            <p>å®Ÿéš›ã®å‰µè–¬é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ã‚²ãƒ¼ãƒ ã§ã™ã€‚å„ãƒ•ã‚§ãƒ¼ã‚ºã§æˆ¦ç•¥çš„ãªé¸æŠã‚’è¡Œã„ã€é™ã‚‰ã‚ŒãŸäºˆç®—ã¨æ™‚é–“ã§æ–°è–¬ã‚’å®Œæˆã•ã›ã¾ã—ã‚‡ã†ã€‚</p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ </strong>ï¼šå„ãƒ•ã‚§ãƒ¼ã‚ºã§3ã¤ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰é¸æŠ
                    <ul style="margin-left: 20px;">
                        <li>å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯1å›ã®ã¿å®Ÿè¡Œå¯èƒ½</li>
                        <li>å…¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œã§ç´„100%é€²æ—ï¼ˆæˆåŠŸ/å¤±æ•—ã«ã‚ˆã‚Šå¤‰å‹•ï¼‰</li>
                        <li>é€²æ—ä¸è¶³æ™‚ã¯ã€Œè¿½åŠ å®Ÿé¨“ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå‡ºç¾</li>
                    </ul>
                </li>
                <li><strong>ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ</strong>ï¼šå„ãƒ•ã‚§ãƒ¼ã‚ºã‚¯ãƒªã‚¢å¾Œã«ç™ºç”Ÿ
                    <ul style="margin-left: 20px;">
                        <li>ãƒã‚¸ãƒ†ã‚£ãƒ–ï¼ˆ40%ï¼‰ã€ãƒã‚¬ãƒ†ã‚£ãƒ–ï¼ˆ40%ï¼‰ã€ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ©ãƒ«ï¼ˆ20%ï¼‰</li>
                        <li>è‡¨åºŠè©¦é¨“æ®µéšã§ã¯é‡ç¯¤ãªå‰¯ä½œç”¨ã®ãƒªã‚¹ã‚¯ã‚ã‚Šï¼ˆå¼·åˆ¶çµ‚äº†ï¼‰</li>
                    </ul>
                </li>
                <li><strong>æˆ¦ç•¥çš„å¯¾å¿œ</strong>ï¼šãƒã‚¬ãƒ†ã‚£ãƒ–ã‚¤ãƒ™ãƒ³ãƒˆæ™‚ã®é¸æŠè‚¢
                    <ul style="margin-left: 20px;">
                        <li>è¿½åŠ äºˆç®—è¦è«‹ï¼šæˆåŠŸç‡ã¯é€²æ—ã«ä¾å­˜ã€å¤±æ•—æ™‚ã¯ä»–ã®é¸æŠè‚¢ã¸</li>
                        <li>æˆ¦ç•¥è¦‹ç›´ã—ï¼šãƒ”ãƒœãƒƒãƒˆã€ææºã€å†è©•ä¾¡ãªã©</li>
                        <li>å‰ãƒ•ã‚§ãƒ¼ã‚ºè£œå¼·ï¼šè¿½åŠ æŠ•è³‡ã§åŸºç›¤ã‚’å¼·åŒ–</li>
                    </ul>
                </li>
                <li><strong>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¼·åˆ¶çµ‚äº†æ¡ä»¶</strong>
                    <ul style="margin-left: 20px;">
                        <li>ã™ã¹ã¦ã®è³‡é‡‘èª¿é”æ‰‹æ®µã‚’ä½¿ã„æœãŸã—ãŸå ´åˆ</li>
                        <li>é‡ç¯¤ãªå‰¯ä½œç”¨ãŒç™ºç”Ÿã—ãŸå ´åˆï¼ˆè‡¨åºŠè©¦é¨“æ®µéšï¼‰</li>
                        <li>è³‡é‡‘èª¿é”ã«å¤±æ•—ã—ã€ä»£æ›¿æ‰‹æ®µãŒãªã„å ´åˆ</li>
                    </ul>
                </li>
                <li><strong>4ã¤ã®é‡è¦æŒ‡æ¨™</strong>ï¼šæˆåŠŸç¢ºç‡ã€äºˆç®—ã€æ™‚é–“ã€å¸‚å ´ç«¶äº‰åŠ›ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ç®¡ç†</li>
            </ul>
        </div>
        
        <div class="status-bar">
            <div class="status-item">
                <h3>ğŸ’° äºˆç®—</h3>
                <p id="budget">$100M</p>
            </div>
            <div class="status-item">
                <h3>ğŸ“… çµŒéæœˆæ•°</h3>
                <p id="months">0</p>
            </div>
            <div class="status-item">
                <h3>ğŸ¯ æˆåŠŸç¢ºç‡</h3>
                <p id="success-rate">5%</p>
            </div>
            <div class="status-item">
                <h3>ğŸ† ç«¶äº‰åŠ›</h3>
                <p id="competitiveness">50%</p>
            </div>
        </div>

        <div id="phase-summary" style="display: none;"></div>
        <div id="phases-container"></div>
        
        <div class="message-log" id="message-log">
            <div class="message">å‰µè–¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹ã—ã¾ã—ãŸï¼äºˆç®—$100Mã§ä¸–ç•Œã‚’å¤‰ãˆã‚‹æ–°è–¬ã‚’é–‹ç™ºã—ã¾ã—ã‚‡ã†ã€‚</div>
        </div>
    </div>

    <div class="event-modal" id="event-modal">
        <div class="event-content" id="event-content"></div>
    </div>

    <script>
        class DrugDiscoveryGame {
            constructor() {
                this.budget = 100000000; // $100M
                this.months = 0;
                this.successRate = 5;
                this.competitiveness = 50;
                this.currentPhase = 0;
                this.messages = [];
                this.eventHistory = [];
                this.totalSpent = 0;
                this.currentEvent = null;
                this.fundingAttempts = {
                    emergency: false,
                    assets: false,
                    joint: false
                };
                
                this.randomEvents = {
                    positive: [
                        {
                            title: "ç”»æœŸçš„ãªç™ºè¦‹",
                            description: "ç ”ç©¶ãƒãƒ¼ãƒ ãŒäºˆæƒ³å¤–ã®ç™ºè¦‹ã‚’ã—ã¾ã—ãŸï¼ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåˆ†å­ã®æ–°ã—ã„ä½œç”¨æ©ŸåºãŒæ˜ã‚‰ã‹ã«ãªã‚Šã€ã‚ˆã‚ŠåŠ¹æœçš„ãªå‰µè–¬ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚",
                            effects: {
                                successRate: 15,
                                competitiveness: 10,
                                message: "æ–°ã—ã„ä½œç”¨æ©Ÿåºã®ç™ºè¦‹ã«ã‚ˆã‚Šã€é–‹ç™ºãŒå¤§ããå‰é€²ã—ã¾ã—ãŸï¼"
                            }
                        },
                        {
                            title: "æ”¿åºœè£œåŠ©é‡‘ç²å¾—",
                            description: "é©æ–°çš„ãªç ”ç©¶å†…å®¹ãŒèªã‚ã‚‰ã‚Œã€æ”¿åºœã‹ã‚‰è¿½åŠ ã®ç ”ç©¶è£œåŠ©é‡‘ã‚’ç²å¾—ã—ã¾ã—ãŸã€‚",
                            effects: {
                                budget: 20000000,
                                successRate: 5,
                                message: "æ”¿åºœè£œåŠ©é‡‘$20Mã‚’ç²å¾—ï¼äºˆç®—ã«ä½™è£•ãŒã§ãã¾ã—ãŸã€‚"
                            }
                        },
                        {
                            title: "AIã«ã‚ˆã‚‹ãƒ–ãƒ¬ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼",
                            description: "æœ€æ–°ã®AIå‰µè–¬ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãŒæœŸå¾…ä»¥ä¸Šã®æˆæœã‚’ä¸Šã’ã€é–‹ç™ºæœŸé–“ã‚’å¤§å¹…ã«çŸ­ç¸®ã§ãã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚",
                            effects: {
                                timeBonus: -3,
                                successRate: 10,
                                competitiveness: 15,
                                message: "AIè§£æã«ã‚ˆã‚Šé–‹ç™ºãŒåŠ é€Ÿï¼æ™‚é–“ã‚’ç¯€ç´„ã§ãã¾ã—ãŸã€‚"
                            }
                        },
                        {
                            title: "ç«¶åˆä»–ç¤¾ã®æ’¤é€€",
                            description: "ä¸»è¦ãªç«¶åˆä»–ç¤¾ãŒåŒã˜é ˜åŸŸã‹ã‚‰æ’¤é€€ã‚’ç™ºè¡¨ã€‚å¸‚å ´ã§ã®å„ªä½æ€§ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã—ãŸã€‚",
                            effects: {
                                competitiveness: 25,
                                successRate: 8,
                                message: "ç«¶åˆã®æ’¤é€€ã«ã‚ˆã‚Šå¸‚å ´ã§ã®ç«‹å ´ãŒå¼·åŒ–ã•ã‚Œã¾ã—ãŸï¼"
                            }
                        }
                    ],
                    negative: [
                        {
                            title: "äºˆæœŸã›ã¬å‰¯ä½œç”¨",
                            description: "å‰è‡¨åºŠè©¦é¨“ã§è»½å¾®ãªãŒã‚‰äºˆæœŸã›ã¬å‰¯ä½œç”¨ãŒç™ºè¦‹ã•ã‚Œã¾ã—ãŸã€‚è¿½åŠ ã®å®‰å…¨æ€§è©¦é¨“ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚",
                            effects: {
                                budget: -10000000,
                                successRate: -10,
                                timeBonus: 3,
                                message: "å‰¯ä½œç”¨ã¸ã®å¯¾å¿œã§è¿½åŠ ã‚³ã‚¹ãƒˆã¨æ™‚é–“ãŒå¿…è¦ã«ãªã‚Šã¾ã—ãŸã€‚"
                            }
                        },
                        {
                            title: "é‡ç¯¤ãªå‰¯ä½œç”¨ç™ºç”Ÿ",
                            description: "è©¦é¨“ä¸­ã«äºˆæœŸã›ã¬é‡ç¯¤ãªå‰¯ä½œç”¨ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚è¢«é¨“è€…ã®å®‰å…¨ã‚’æœ€å„ªå…ˆã—ã€è¦åˆ¶å½“å±€ã¸ã®å ±å‘ŠãŒå¿…è¦ã§ã™ã€‚",
                            effects: {
                                isCritical: true,
                                message: "é‡ç¯¤ãªå‰¯ä½œç”¨ã«ã‚ˆã‚Šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä¸­æ­¢ã•ã‚Œã¾ã—ãŸã€‚"
                            }
                        },
                        {
                            title: "è¦åˆ¶å½“å±€ã‹ã‚‰ã®æŒ‡å°",
                            description: "è¦åˆ¶å½“å±€ã‹ã‚‰è©¦é¨“ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ä¿®æ­£ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã—ãŸã€‚æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹ãŒã‚ˆã‚Šå³æ ¼ã«ãªã‚Šã¾ã™ã€‚",
                            effects: {
                                successRate: -15,
                                competitiveness: -10,
                                message: "è¦åˆ¶è¦ä»¶ã®å¼·åŒ–ã«ã‚ˆã‚Šé–‹ç™ºé›£æ˜“åº¦ãŒä¸Šæ˜‡ã—ã¾ã—ãŸã€‚"
                            }
                        },
                        {
                            title: "ä¸»è¦ç ”ç©¶è€…ã®é›¢è„±",
                            description: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸»è¦ç ”ç©¶è€…ãŒç«¶åˆä»–ç¤¾ã«å¼•ãæŠœã‹ã‚Œã¾ã—ãŸã€‚ãƒãƒ¼ãƒ ã®å†ç·¨ãŒå¿…è¦ã§ã™ã€‚",
                            effects: {
                                successRate: -12,
                                competitiveness: -15,
                                budget: -5000000,
                                message: "äººææµå‡ºã«ã‚ˆã‚Šé–‹ç™ºä½“åˆ¶ã®ç«‹ã¦ç›´ã—ãŒå¿…è¦ã«ãªã‚Šã¾ã—ãŸã€‚"
                            }
                        },
                        {
                            title: "ç‰¹è¨±ç´›äº‰",
                            description: "ç«¶åˆä»–ç¤¾ã‹ã‚‰ç‰¹è¨±ä¾µå®³ã®ç”³ã—ç«‹ã¦ã‚’å—ã‘ã¾ã—ãŸã€‚æ³•çš„å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚",
                            effects: {
                                budget: -15000000,
                                competitiveness: -20,
                                message: "ç‰¹è¨±ç´›äº‰ã¸ã®å¯¾å¿œã§å¤šé¡ã®è²»ç”¨ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"
                            }
                        }
                    ],
                    neutral: [
                        {
                            title: "å¸‚å ´ç’°å¢ƒã®å¤‰åŒ–",
                            description: "å¯¾è±¡ç–¾æ‚£ã«å¯¾ã™ã‚‹æ–°ã—ã„æ²»ç™‚æ³•ãŒä»–ç¤¾ã‹ã‚‰ç™ºè¡¨ã•ã‚Œã¾ã—ãŸã€‚æˆ¦ç•¥ã®è¦‹ç›´ã—ãŒå¿…è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚",
                            effects: {
                                competitiveness: -5,
                                strategicShift: true,
                                message: "å¸‚å ´ç’°å¢ƒãŒå¤‰åŒ–ã—ã¾ã—ãŸã€‚æˆ¦ç•¥ã®èª¿æ•´ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚"
                            }
                        },
                        {
                            title: "ãƒ‘ãƒ³ãƒ‡ãƒŸãƒƒã‚¯ã®å½±éŸ¿",
                            description: "ä¸–ç•Œçš„ãªæ„ŸæŸ“ç—‡ã®æµè¡Œã«ã‚ˆã‚Šã€è‡¨åºŠè©¦é¨“ã®å®Ÿæ–½æ–¹æ³•ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
                            effects: {
                                timeBonus: 2,
                                budget: -5000000,
                                message: "è©¦é¨“æ–¹æ³•ã®å¤‰æ›´ã«ã‚ˆã‚Šè‹¥å¹²ã®é…å»¶ã¨ã‚³ã‚¹ãƒˆå¢—ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"
                            }
                        }
                    ]
                };
                
                this.phases = [
                    {
                        name: "ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢",
                        description: "ç–¾æ‚£ã®åŸå› ã¨ãªã‚‹åˆ†å­ï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼‰ã‚’ç‰¹å®šã—ã¾ã™ã€‚ã“ã®æ®µéšã§ã®é¸æŠãŒã€ãã®å¾Œã®é–‹ç™ºå…¨ä½“ã®æ–¹å‘æ€§ã‚’æ±ºå®šã—ã¾ã™ã€‚",
                        duration: 6,
                        progress: 0,
                        cost: 5000000,
                        successBonus: 10,
                        riskFactor: 0.8,
                        actions: [
                            { 
                                name: "åŸºç¤ç ”ç©¶é‡è¦–", 
                                cost: 1500000, 
                                time: 3, 
                                success: 5,
                                competitiveness: 5,
                                description: "ã‚¢ã‚«ãƒ‡ãƒŸã‚¢ã¨ã®å…±åŒç ”ç©¶ã§åŸºç¤çš„ãªãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’è§£æ˜"
                            },
                            { 
                                name: "ãƒã‚¤ã‚ªã‚¤ãƒ³ãƒ•ã‚©ãƒãƒ†ã‚£ã‚¯ã‚¹æ´»ç”¨", 
                                cost: 2500000, 
                                time: 2, 
                                success: 8,
                                competitiveness: 10,
                                description: "AIã¨ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨ã—ãŸåŠ¹ç‡çš„ãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢"
                            },
                            { 
                                name: "è‡¨åºŠãƒ‡ãƒ¼ã‚¿åˆ†æ", 
                                cost: 3000000, 
                                time: 2, 
                                success: 10,
                                competitiveness: 15,
                                description: "å®Ÿéš›ã®æ‚£è€…ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æœ‰æœ›ãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ç‰¹å®š"
                            }
                        ]
                    },
                    {
                        name: "ãƒªãƒ¼ãƒ‰åŒ–åˆç‰©æ¢ç´¢",
                        description: "ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ä½œç”¨ã™ã‚‹åŒ–åˆç‰©ã‚’æ¢ç´¢ãƒ»æœ€é©åŒ–ã—ã¾ã™ã€‚æ•°åä¸‡ã®å€™è£œã‹ã‚‰æœ€ã‚‚æœ‰æœ›ãªåŒ–åˆç‰©ã‚’é¸ã³å‡ºã™é‡è¦ãªãƒ•ã‚§ãƒ¼ã‚ºã§ã™ã€‚",
                        duration: 12,
                        progress: 0,
                        cost: 15000000,
                        successBonus: 15,
                        riskFactor: 0.7,
                        actions: [
                            { 
                                name: "ãƒã‚¤ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°", 
                                cost: 6000000, 
                                time: 4, 
                                success: 8,
                                competitiveness: 8,
                                description: "å¤§è¦æ¨¡ãªåŒ–åˆç‰©ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‹ã‚‰è‡ªå‹•ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°"
                            },
                            { 
                                name: "AIå‰µè–¬ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ", 
                                cost: 10000000, 
                                time: 3, 
                                success: 12,
                                competitiveness: 20,
                                description: "æœ€æ–°ã®AIæŠ€è¡“ã§æ–°è¦åŒ–åˆç‰©ã‚’ãƒ‡ã‚¶ã‚¤ãƒ³"
                            },
                            { 
                                name: "ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹å‰µè–¬", 
                                cost: 8000000, 
                                time: 5, 
                                success: 15,
                                competitiveness: 12,
                                description: "å°ã•ãªåˆ†å­ç‰‡ã‹ã‚‰æ®µéšçš„ã«åŒ–åˆç‰©ã‚’æ§‹ç¯‰"
                            }
                        ]
                    },
                    {
                        name: "å‰è‡¨åºŠè©¦é¨“",
                        description: "å‹•ç‰©å®Ÿé¨“ã§å®‰å…¨æ€§ã¨æœ‰åŠ¹æ€§ã‚’ç¢ºèªã—ã¾ã™ã€‚ãƒ’ãƒˆã§ã®è©¦é¨“ã«é€²ã‚€å‰ã®æœ€å¾Œã®é–¢é–€ã§ã™ã€‚",
                        duration: 18,
                        progress: 0,
                        cost: 25000000,
                        successBonus: 20,
                        riskFactor: 0.6,
                        actions: [
                            { 
                                name: "æ¨™æº–çš„ãªæ¯’æ€§è©•ä¾¡", 
                                cost: 8000000, 
                                time: 6, 
                                success: 10,
                                competitiveness: 5,
                                description: "è¦åˆ¶è¦ä»¶ã‚’æº€ãŸã™åŸºæœ¬çš„ãªå®‰å…¨æ€§è©¦é¨“"
                            },
                            { 
                                name: "åŒ…æ‹¬çš„å®‰å…¨æ€§ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸", 
                                cost: 15000000, 
                                time: 5, 
                                success: 18,
                                competitiveness: 15,
                                description: "è¿½åŠ ã®ç‰¹æ®Šæ¯’æ€§è©¦é¨“ã‚’å«ã‚€åŒ…æ‹¬çš„ãªè©•ä¾¡"
                            },
                            { 
                                name: "ãƒˆãƒ©ãƒ³ã‚¹ãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ç ”ç©¶", 
                                cost: 12000000, 
                                time: 4, 
                                success: 15,
                                competitiveness: 18,
                                description: "ãƒ’ãƒˆã§ã®åŠ¹æœã‚’äºˆæ¸¬ã™ã‚‹å…ˆé€²çš„ãªè©¦é¨“ç³»ã‚’ä½¿ç”¨"
                            }
                        ]
                    },
                    {
                        name: "è‡¨åºŠè©¦é¨“ Phase I",
                        description: "åˆã‚ã¦ãƒ’ãƒˆã«æŠ•ä¸ã—ã€å®‰å…¨æ€§ã¨è–¬ç‰©å‹•æ…‹ã‚’ç¢ºèªã—ã¾ã™ã€‚å°‘æ•°ã®å¥åº·ãªå¿—é¡˜è€…ã¾ãŸã¯æ‚£è€…ã§å®Ÿæ–½ã—ã¾ã™ã€‚",
                        duration: 12,
                        progress: 0,
                        cost: 20000000,
                        successBonus: 15,
                        riskFactor: 0.5,
                        actions: [
                            { 
                                name: "å¾“æ¥å‹Phase Iè©¦é¨“", 
                                cost: 8000000, 
                                time: 4, 
                                success: 10,
                                competitiveness: 5,
                                description: "æ¨™æº–çš„ãªç”¨é‡æ¼¸å¢—è©¦é¨“ãƒ‡ã‚¶ã‚¤ãƒ³"
                            },
                            { 
                                name: "é©å¿œå‹ãƒ‡ã‚¶ã‚¤ãƒ³", 
                                cost: 12000000, 
                                time: 3, 
                                success: 15,
                                competitiveness: 15,
                                description: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãæŸ”è»Ÿãªè©¦é¨“è¨­è¨ˆ"
                            },
                            { 
                                name: "ãƒã‚¤ã‚ªãƒãƒ¼ã‚«ãƒ¼ä½µç”¨è©¦é¨“", 
                                cost: 15000000, 
                                time: 4, 
                                success: 18,
                                competitiveness: 20,
                                description: "åŠ¹æœäºˆæ¸¬ãƒãƒ¼ã‚«ãƒ¼ã‚’æ´»ç”¨ã—ãŸç²¾å¯†åŒ»ç™‚ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ"
                            }
                        ]
                    },
                    {
                        name: "è‡¨åºŠè©¦é¨“ Phase II/III",
                        description: "å¤šæ•°ã®æ‚£è€…ã§æœ‰åŠ¹æ€§ã¨å®‰å…¨æ€§ã‚’è¨¼æ˜ã™ã‚‹æœ€çµ‚æ®µéšã§ã™ã€‚æˆåŠŸã™ã‚Œã°æ–°è–¬æ‰¿èªã¸é€²ã‚ã¾ã™ã€‚",
                        duration: 36,
                        progress: 0,
                        cost: 50000000,
                        successBonus: 25,
                        riskFactor: 0.4,
                        actions: [
                            { 
                                name: "å›½å†…å¤šæ–½è¨­å…±åŒè©¦é¨“", 
                                cost: 20000000, 
                                time: 12, 
                                success: 15,
                                competitiveness: 10,
                                description: "å›½å†…ã®ä¸»è¦åŒ»ç™‚æ©Ÿé–¢ã§ã®å¤§è¦æ¨¡è©¦é¨“"
                            },
                            { 
                                name: "ã‚°ãƒ­ãƒ¼ãƒãƒ«è©¦é¨“", 
                                cost: 35000000, 
                                time: 10, 
                                success: 25,
                                competitiveness: 25,
                                description: "ä¸–ç•ŒåŒæ™‚é–‹ç™ºã«ã‚ˆã‚‹è¿…é€Ÿãªå¸‚å ´ã‚¢ã‚¯ã‚»ã‚¹"
                            },
                            { 
                                name: "ãƒªã‚¢ãƒ«ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹æ´»ç”¨", 
                                cost: 25000000, 
                                time: 8, 
                                success: 20,
                                competitiveness: 30,
                                description: "å®Ÿè‡¨åºŠãƒ‡ãƒ¼ã‚¿ã‚’æ´»ç”¨ã—ãŸé©æ–°çš„ãªæ‰¿èªæˆ¦ç•¥"
                            }
                        ]
                    }
                ];
                
                this.init();
            }
            
            init() {
                this.renderPhases();
                this.updateStatus();
                this.addMessage("å‰µè–¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹ã—ã¾ã—ãŸï¼äºˆç®—$100Mã§ä¸–ç•Œã‚’å¤‰ãˆã‚‹æ–°è–¬ã‚’é–‹ç™ºã—ã¾ã—ã‚‡ã†ã€‚", "success");
            }
            
            renderPhases() {
                const container = document.getElementById('phases-container');
                container.innerHTML = '';
                
                this.phases.forEach((phase, index) => {
                    const phaseEl = document.createElement('div');
                    phaseEl.className = 'phase-container';
                    
                    const status = index < this.currentPhase ? 'completed' : 
                                 index === this.currentPhase ? 'active' : 'locked';
                    
                    phaseEl.innerHTML = `
                        <div class="phase-header">
                            <h2 class="phase-title">${phase.name}</h2>
                            <span class="phase-status ${status}">${
                                status === 'completed' ? 'å®Œäº†' : 
                                status === 'active' ? 'é€²è¡Œä¸­' : 'ãƒ­ãƒƒã‚¯ä¸­'
                            }</span>
                        </div>
                        <div class="phase-description">
                            ${phase.description}
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${phase.progress}%">
                                ${Math.round(phase.progress)}%
                            </div>
                        </div>
                        <div class="action-buttons" id="actions-${index}"></div>
                    `;
                    
                    container.appendChild(phaseEl);
                    
                    if (index === this.currentPhase) {
                        this.renderActions(index);
                    }
                });
            }
            
            renderActions(phaseIndex) {
                const actionsContainer = document.getElementById(`actions-${phaseIndex}`);
                const phase = this.phases[phaseIndex];
                
                actionsContainer.innerHTML = '';
                
                if (phase.progress >= 100) {
                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'btn btn-success';
                    nextBtn.innerHTML = 'ğŸ‰ ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ï¼æ¬¡ã¸é€²ã‚€ â†’';
                    nextBtn.onclick = () => this.completePhase();
                    actionsContainer.appendChild(nextBtn);
                    return;
                }
                
                phase.actions.forEach((action, actionIndex) => {
                    const isExecuted = phase.executedActions && phase.executedActions.includes(actionIndex);
                    const card = document.createElement('div');
                    card.className = `action-card ${this.budget < action.cost || isExecuted ? 'disabled' : ''}`;
                    
                    card.innerHTML = `
                        <h4>${action.name} ${isExecuted ? 'âœ“' : ''}</h4>
                        <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">${action.description}</p>
                        <div class="action-details">
                            <div class="action-detail">
                                <span>ğŸ’°</span>
                                <span>${(action.cost/1000000).toFixed(1)}M</span>
                            </div>
                            <div class="action-detail">
                                <span>â±ï¸</span>
                                <span>${action.time}ãƒ¶æœˆ</span>
                            </div>
                        </div>
                        <div class="action-details">
                            <div class="action-detail">
                                <span>ğŸ¯</span>
                                <span>+${action.success}%</span>
                            </div>
                            <div class="action-detail">
                                <span>ğŸ†</span>
                                <span>+${action.competitiveness}%</span>
                            </div>
                        </div>
                        <button class="btn ${isExecuted ? 'btn-success' : 'btn-primary'}" 
                                ${this.budget < action.cost || isExecuted ? 'disabled' : ''} 
                                onclick="game.executeAction(${phaseIndex}, ${actionIndex})">
                            ${isExecuted ? 'å®Ÿè¡Œæ¸ˆã¿' : 'å®Ÿè¡Œ'}
                        </button>
                    `;
                    
                    actionsContainer.appendChild(card);
                });
                
                // å…¨ã¦ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œæ¸ˆã¿ã§ã‚‚100%ã«é”ã—ã¦ã„ãªã„å ´åˆã®è¿½åŠ ã‚ªãƒ—ã‚·ãƒ§ãƒ³
                if (phase.executedActions && phase.executedActions.length === phase.actions.length && phase.progress < 100) {
                    const additionalCard = document.createElement('div');
                    additionalCard.className = 'action-card';
                    additionalCard.style.borderColor = '#ff9800';
                    additionalCard.innerHTML = `
                        <h4>è¿½åŠ å®Ÿé¨“</h4>
                        <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                            åŸºæœ¬å®Ÿé¨“ãŒå®Œäº†ã—ã¾ã—ãŸã€‚è¿½åŠ å®Ÿé¨“ã§é€²æ—ã‚’100%ã¾ã§é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
                        </p>
                        <div class="action-details">
                            <div class="action-detail">
                                <span>ğŸ’°</span>
                                <span>$3.0M</span>
                            </div>
                            <div class="action-detail">
                                <span>â±ï¸</span>
                                <span>2ãƒ¶æœˆ</span>
                            </div>
                        </div>
                        <button class="btn btn-warning" ${this.budget < 3000000 ? 'disabled' : ''} 
                                onclick="game.executeAdditionalWork(${phaseIndex})">
                            è¿½åŠ å®Ÿé¨“ã‚’å®Ÿæ–½
                        </button>
                    `;
                    actionsContainer.appendChild(additionalCard);
                }
            }
            
            executeAction(phaseIndex, actionIndex) {
                const phase = this.phases[phaseIndex];
                const action = phase.actions[actionIndex];

                // --- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢ã®ç‰¹æ®Šè¡Œãè©°ã¾ã‚Šæ¼”å‡º ---
                if (phaseIndex === 0 && this.budget < action.cost) {
                    // äºˆç®—ä¸è¶³ã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã§ããªã„å ´åˆ
                    // ã“ã“ã§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢è¡Œãè©°ã¾ã‚Šæ¼”å‡ºã«åˆ†å²
                    this.showTargetStuckModal();
                    return;
                }

                if (this.budget < action.cost) {
                    this.addMessage(`âŒ äºˆç®—ä¸è¶³ã§ã™ï¼ ${(action.cost/1000000).toFixed(1)}Må¿…è¦ã§ã™ã€‚`, "error");
                    // ãƒ•ã‚§ãƒ¼ã‚ºå†…ã§ä»–ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚‚å…¨ã¦äºˆç®—ä¸è¶³ãªã‚‰æ•‘æ¸ˆãƒ¢ãƒ¼ãƒ€ãƒ«
                    if (this.isPhaseActionStuck(phaseIndex)) {
                        setTimeout(() => this.showRescueModal(), 500);
                    }
                    return;
                }

                // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œæ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
                if (!phase.executedActions) {
                    phase.executedActions = [];
                }

                if (phase.executedActions.includes(actionIndex)) {
                    this.addMessage(`âš ï¸ ${action.name}ã¯æ—¢ã«å®Ÿè¡Œæ¸ˆã¿ã§ã™ã€‚`, "warning");
                    return;
                }

                this.budget -= action.cost;
                this.totalSpent += action.cost;
                this.months += action.time;
                phase.executedActions.push(actionIndex);

                // åŸºæœ¬é€²æ—ã‚’è¨ˆç®—ï¼ˆå„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§33.33%ç¨‹åº¦é€²ã‚€ï¼‰
                const baseProgress = 100 / phase.actions.length;

                const risk = Math.random();
                if (risk < phase.riskFactor) {
                    phase.progress += baseProgress * 1.2;
                    this.successRate += action.success;
                    this.competitiveness += action.competitiveness;
                    this.addMessage(`âœ… ${action.name}ãŒæˆåŠŸã—ã¾ã—ãŸï¼`, "success");
                } else {
                    phase.progress += baseProgress * 0.8;
                    this.successRate += action.success * 0.3;
                    this.competitiveness += action.competitiveness * 0.5;
                    this.addMessage(`âš ï¸ ${action.name}ã§å•é¡ŒãŒç™ºç”Ÿã€‚é€²æ—ãŒé…ã‚Œã¦ã„ã¾ã™ã€‚`, "warning");
                }

                phase.progress = Math.min(phase.progress, 100);
                this.successRate = Math.min(Math.max(this.successRate, 0), 95);
                this.competitiveness = Math.min(Math.max(this.competitiveness, 0), 100);

                this.updateStatus();
                this.renderPhases();

                // äºˆç®—ãƒã‚§ãƒƒã‚¯
                if (this.budget <= 0) {
                    this.addMessage("ğŸ’¸ äºˆç®—ãŒå®Œå…¨ã«æ¯æ¸‡ã—ã¾ã—ãŸï¼", "error");
                    setTimeout(() => this.showResourceOptions(), 500);
                } else {
                    // ãƒ•ã‚§ãƒ¼ã‚ºå†…ã§æœªå®Ÿè¡Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒæ®‹ã‚Šã€ã‹ã¤ã©ã‚Œã‚‚äºˆç®—ä¸è¶³ãªã‚‰æ•‘æ¸ˆãƒ¢ãƒ¼ãƒ€ãƒ«
                    if (this.isPhaseActionStuck(phaseIndex)) {
                        setTimeout(() => this.showRescueModal(), 500);
                    }
                }
            }

            // ãƒ•ã‚§ãƒ¼ã‚ºå†…ã§æœªå®Ÿè¡Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒæ®‹ã‚Šã€ã©ã‚Œã‚‚äºˆç®—ä¸è¶³ã‹åˆ¤å®š
            isPhaseActionStuck(phaseIndex) {
                const phase = this.phases[phaseIndex];
                if (!phase.executedActions) phase.executedActions = [];
                // æœªå®Ÿè¡Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                const remainActions = phase.actions
                    .map((a, i) => ({a, i}))
                    .filter(({a, i}) => !phase.executedActions.includes(i));
                if (remainActions.length === 0) return false;
                return remainActions.every(({a}) => this.budget < a.cost);
            }

            // --- è³‡é‡‘ä¸è¶³æ™‚æ•‘æ¸ˆãƒ¢ãƒ¼ãƒ€ãƒ« ---
            showRescueModal() {
                const modal = document.getElementById('event-modal');
                const content = document.getElementById('event-content');
                // å°å‡ºã¯ç«¶äº‰åŠ›80%ä»¥ä¸Šã®ã¿é¸æŠå¯
                const canOutLicense = this.competitiveness >= 80;
                content.innerHTML = `
                    <div class="event-header" style="text-align:center;">
                        <div class="event-icon" style="font-size:5em;">ğŸš¨</div>
                        <h2 class="event-title" style="color:#d32f2f; font-size:2em;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè³‡é‡‘è¡Œãè©°ã¾ã‚Š</h2>
                    </div>
                    <div class="event-description" style="font-size:1.2em; margin-bottom:20px;">
                        <b>å…¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œã«å¿…è¦ãªäºˆç®—ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚</b><br>
                        <br>
                        <span style="color:#c62828;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸­æ­¢</span> ã¾ãŸã¯
                        <span style="color:#1976d2;">å°å‡ºï¼ˆä»–ç¤¾ã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚¢ã‚¦ãƒˆï¼‰</span>ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚
                    </div>
                    <div style="display:flex; flex-direction:column; gap:18px; align-items:center;">
                        <button class="btn btn-danger" style="width:80%; font-size:1.1em; padding:15px;" onclick="game.strategicTermination()">
                            ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸­æ­¢
                        </button>
                        <button class="btn btn-primary" style="width:80%; font-size:1.1em; padding:15px; ${canOutLicense ? '' : 'opacity:0.5;cursor:not-allowed;'}" ${canOutLicense ? '' : 'disabled'}
                            onclick="if(${canOutLicense})game.executeOutLicense()">
                            å°å‡ºã«æŒ‘æˆ¦ï¼ˆç«¶äº‰åŠ›80%ä»¥ä¸Šã§é¸æŠå¯ï¼‰
                        </button>
                    </div>
                    <div style="margin-top:20px; color:#888; font-size:1em;">
                        ãƒ»å°å‡ºæ™‚ï¼šã‚¢ãƒƒãƒ—ãƒ•ãƒ­ãƒ³ãƒˆ$50Mç²å¾—ã€ãã®ã‚¹ãƒ†ãƒ¼ã‚¸å®Œäº†å¾Œ$100Mè¿½åŠ ã€æœ€çµ‚æˆåŠŸæ™‚$500Mè¿½åŠ å ±é…¬ï¼ˆä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚é–‹å§‹å¯ï¼‰
                    </div>
                `;
                modal.style.display = 'flex';
            }

            // å°å‡ºæ•‘æ¸ˆãƒ­ã‚¸ãƒƒã‚¯
            executeOutLicense() {
                // ãƒ•ãƒ©ã‚°ã‚’ã‚»ãƒƒãƒˆï¼ˆå°å‡ºæ•‘æ¸ˆé€²è¡Œä¸­ï¼‰
                if (!this.outLicense) this.outLicense = { phase: this.currentPhase, upfront: false, milestone: false, success: false };
                this.outLicense.phase = this.currentPhase;
                this.outLicense.upfront = true;
                this.outLicense.milestone = false;
                this.outLicense.success = false;
                // ã‚¢ãƒƒãƒ—ãƒ•ãƒ­ãƒ³ãƒˆ$50M
                this.budget += 50000000;
                this.addMessage("ğŸ“ å°å‡ºå¥‘ç´„æˆç«‹ï¼ã‚¢ãƒƒãƒ—ãƒ•ãƒ­ãƒ³ãƒˆ$50Mã‚’ç²å¾—ã€‚", "success");
                document.getElementById('event-modal').style.display = 'none';
                this.updateStatus();
                this.renderPhases();
                // ãƒ•ã‚§ãƒ¼ã‚ºã‚’å¼·åˆ¶å®Œäº†ã¸
                setTimeout(() => this.completePhaseByOutLicense(), 500);
            }

            // å°å‡ºæ•‘æ¸ˆæ™‚ï¼šãƒ•ã‚§ãƒ¼ã‚ºå¼·åˆ¶å®Œäº†
            completePhaseByOutLicense() {
                // é€²æ—ã‚’100%ã«
                const phase = this.phases[this.currentPhase];
                phase.progress = 100;
                if (!phase.executedActions) phase.executedActions = [];
                // å…¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ¸ˆã¿æ‰±ã„
                phase.executedActions = phase.actions.map((a,i)=>i);
                this.addMessage("å°å‡ºã«ã‚ˆã‚Šã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¯å®Œäº†æ‰±ã„ã¨ãªã‚Šã¾ã™ã€‚", "event");
                this.updateStatus();
                this.renderPhases();
                // ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ã‚µãƒãƒªãƒ¼
                this.showPhaseSummary();
                // æ¬¡ã¸é€²ã‚€
                setTimeout(() => {
                    // milestoneå ±é…¬
                    if (this.outLicense && !this.outLicense.milestone) {
                        this.budget += 100000000;
                        this.addMessage("ğŸ‰ å°å‡ºãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é”æˆï¼è¿½åŠ $100Mç²å¾—ã€‚", "success");
                        this.outLicense.milestone = true;
                        this.updateStatus();
                    }
                    this.currentPhase++;
                    if (this.currentPhase >= this.phases.length) {
                        this.gameOver(true);
                    } else {
                        this.addMessage(`ğŸ“‹ ${this.phases[this.currentPhase].name}ã‚’é–‹å§‹ã—ã¾ã™ã€‚`, "success");
                        this.renderPhases();
                    }
                }, 1800);
            }

            // å°å‡ºæ•‘æ¸ˆæ™‚ï¼šæœ€çµ‚æˆåŠŸã§è¿½åŠ å ±é…¬ï¼†ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹å¯
            gameOver(success) {
                const container = document.getElementById('phases-container');
                const gameOverEl = document.createElement('div');
                gameOverEl.className = 'game-over';

                // å°å‡ºæ•‘æ¸ˆãƒ•ãƒ©ã‚°ãŒã‚ã‚Šã€æˆåŠŸã®å ´åˆ
                if (success && this.outLicense && !this.outLicense.success) {
                    this.budget += 500000000;
                    this.addMessage("ğŸ’° å°å‡ºå¥‘ç´„æœ€çµ‚æˆåŠŸï¼è¿½åŠ $500Mã‚’ç²å¾—ã€‚ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚é–‹å§‹å¯èƒ½ï¼", "success");
                    this.outLicense.success = true;
                }
                if (success) {
                    const finalScore = (this.successRate * 0.6 + this.competitiveness * 0.4);
                    const finalSuccess = Math.random() * 100 < finalScore;
                    if (finalSuccess) {
                        gameOverEl.innerHTML = `
                            <h2>ğŸŠ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</h2>
                            <p>æ–°è–¬ã®é–‹ç™ºã«æˆåŠŸã—ã¾ã—ãŸï¼</p>
                            <p>é–‹ç™ºæœŸé–“: ${this.months}ãƒ¶æœˆ</p>
                            <p>ç·é–‹ç™ºè²»: $${(this.totalSpent/1000000).toFixed(1)}M</p>
                            <p>æ®‹ã‚Šäºˆç®—: $${(this.budget/1000000).toFixed(1)}M</p>
                            <p>æœ€çµ‚æˆåŠŸç¢ºç‡: ${Math.round(this.successRate)}%</p>
                            <p>å¸‚å ´ç«¶äº‰åŠ›: ${Math.round(this.competitiveness)}%</p>
                            ${this.outLicense && this.outLicense.success ? `<p style="color:#1976d2; font-size:1.2em;">å°å‡ºå¥‘ç´„ã«ã‚ˆã‚Šç·é¡$650Mã®åç›Šã‚’ç²å¾—ï¼<br>ï¼ˆã‚¢ãƒƒãƒ—ãƒ•ãƒ­ãƒ³ãƒˆ/ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³/æˆåŠŸå ±é…¬ï¼‰</p>
                            <p style="color:#388e3c; font-size:1.1em;">ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚‚åŒæ™‚ã«é–‹å§‹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼</p>` : ''}
                            <button class="btn btn-success restart-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
                        `;
                    } else {
                        gameOverEl.innerHTML = `
                            <h2>ğŸ˜¢ æƒœã—ã„ï¼</h2>
                            <p>æœ€çµ‚æ‰¿èªã§å´ä¸‹ã•ã‚Œã¾ã—ãŸã€‚</p>
                            <p>æˆåŠŸç¢ºç‡${Math.round(this.successRate)}%ã€ç«¶äº‰åŠ›${Math.round(this.competitiveness)}%ã§ã—ãŸãŒã€æ‰¿èªåŸºæº–ã‚’æº€ãŸã›ã¾ã›ã‚“ã§ã—ãŸã€‚</p>
                            <button class="btn btn-warning restart-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
                        `;
                    }
                } else {
                    gameOverEl.innerHTML = `
                        <h2>ğŸ’¸ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</h2>
                        <p>äºˆç®—ãŒå°½ãã¦ã—ã¾ã„ã¾ã—ãŸ...</p>
                        <p>é–‹ç™ºæœŸé–“: ${this.months}ãƒ¶æœˆ</p>
                        <p>åˆ°é”ãƒ•ã‚§ãƒ¼ã‚º: ${this.phases[this.currentPhase].name}</p>
                        <button class="btn btn-warning restart-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
                    `;
                }
                container.innerHTML = '';
                container.appendChild(gameOverEl);
            }

            // --- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢è¡Œãè©°ã¾ã‚Šï¼ˆäºˆç®—ä¸è¶³æ™‚ï¼‰æ–°æ¼”å‡º ---
            showTargetStuckModal() {
                const modal = document.getElementById('event-modal');
                const content = document.getElementById('event-content');
                content.innerHTML = `
                    <div class="event-header" style="text-align:center;">
                        <div class="event-icon" style="font-size:4em;">ğŸ”¬</div>
                        <h2 class="event-title" style="color:#e65100; font-size:1.7em;">è–¬ç†éƒ¨ç½²ã«ç§»ç®¡â†’å†ç¾æ€§æ¶ˆå¤±</h2>
                    </div>
                    <div class="event-description" style="font-size:1.1em;">
                        <b>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢ãŒè³‡é‡‘ä¸è¶³ã«ã‚ˆã‚Šè–¬ç†éƒ¨ç½²ã¸ç§»ç®¡ã•ã‚Œã¾ã—ãŸãŒã€<br>å†ç¾æ€§ãŒå¾—ã‚‰ã‚Œãšè¡Œãè©°ã¾ã‚Šã¾ã—ãŸã€‚</b>
                        <br><br>
                        æ¬¡ã®ä¸€æ‰‹ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
                    </div>
                    <div style="display:flex; flex-direction:column; gap:15px; margin-top:20px;">
                        <button class="btn btn-info" style="font-size:1.1em; padding:12px;" onclick="game.targetStuckKOL()">
                            KOLã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿæ–½
                        </button>
                        <button class="btn btn-primary" style="font-size:1.1em; padding:12px;" onclick="game.targetStuckNewInfo()">
                            æ–°è¦æƒ…å ±ã‚’å–å¾—ï¼ˆå­¦ä¼š/è«–æ–‡ï¼‰
                        </button>
                    </div>
                `;
                modal.style.display = 'flex';
            }

            // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢è¡Œãè©°ã¾ã‚Šâ†’KOLã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼
            targetStuckKOL() {
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¦æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºã¸
                document.getElementById('event-modal').style.display = 'none';
                this.addMessage("KOLã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ã§æ–°ãŸãªçŸ¥è¦‹ã‚’å¾—ã¦ã€é–‹ç™ºã‚’ãƒªã‚¹ã‚¿ãƒ¼ãƒˆï¼", "success");
                // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢ã‚’è‡ªå‹•å®Œäº†ã—ã€ãƒªãƒ¼ãƒ‰åŒ–åˆç‰©æ¢ç´¢ã¸
                const phase = this.phases[this.currentPhase];
                phase.progress = 100;
                phase.executedActions = phase.actions.map((a,i)=>i);
                this.currentPhase++;
                this.renderPhases();
                this.updateStatus();
                this.addMessage(`ğŸ“‹ ${this.phases[this.currentPhase].name}ã‚’é–‹å§‹ã—ã¾ã™ã€‚`, "success");
            }

            // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢è¡Œãè©°ã¾ã‚Šâ†’æ–°è¦æƒ…å ±å–å¾—
            targetStuckNewInfo() {
                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¦æ¬¡ãƒ•ã‚§ãƒ¼ã‚ºã¸
                document.getElementById('event-modal').style.display = 'none';
                this.addMessage("å­¦ä¼šãƒ»è«–æ–‡ã‹ã‚‰æ–°è¦æƒ…å ±ã‚’å–å¾—ï¼æ–°ãŸãªæ–¹é‡ã§å†å§‹å‹•ã€‚", "success");
                // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢ã‚’è‡ªå‹•å®Œäº†ã—ã€ãƒªãƒ¼ãƒ‰åŒ–åˆç‰©æ¢ç´¢ã¸
                const phase = this.phases[this.currentPhase];
                phase.progress = 100;
                phase.executedActions = phase.actions.map((a,i)=>i);
                this.currentPhase++;
                this.renderPhases();
                this.updateStatus();
                this.addMessage(`ğŸ“‹ ${this.phases[this.currentPhase].name}ã‚’é–‹å§‹ã—ã¾ã™ã€‚`, "success");
            }
            
            completePhase() {
                const currentPhaseName = this.phases[this.currentPhase].name;
                
                // ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
                this.showPhaseSummary();
                
                // ãƒ©ãƒ³ãƒ€ãƒ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿ
                setTimeout(() => {
                    this.triggerRandomEvent();
                }, 1500);
            }
            
            showPhaseSummary() {
                const summaryDiv = document.getElementById('phase-summary');
                const phase = this.phases[this.currentPhase];
                
                summaryDiv.innerHTML = `
                    <div class="phase-summary">
                        <h3>ğŸ“Š ${phase.name} å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-label">æ¶ˆè²»äºˆç®—</div>
                                <div class="summary-value">$${(this.totalSpent/1000000).toFixed(1)}M</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">çµŒéæ™‚é–“</div>
                                <div class="summary-value">${this.months}ãƒ¶æœˆ</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">ç¾åœ¨ã®æˆåŠŸç¢ºç‡</div>
                                <div class="summary-value">${Math.round(this.successRate)}%</div>
                            </div>
                        </div>
                    </div>
                `;
                
                summaryDiv.style.display = 'block';
                
                setTimeout(() => {
                    summaryDiv.style.display = 'none';
                }, 5000);
            }
            
            triggerRandomEvent() {
                const eventType = Math.random();
                let events;
                
                // è‡¨åºŠè©¦é¨“ãƒ•ã‚§ãƒ¼ã‚ºã§ã®ã¿é‡ç¯¤ãªå‰¯ä½œç”¨ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§
                const canHaveCriticalEvent = this.currentPhase >= 3; // Phase Iä»¥é™
                
                if (eventType < 0.4) {
                    events = this.randomEvents.positive;
                } else if (eventType < 0.8) {
                    events = [...this.randomEvents.negative];
                    // è‡¨åºŠè©¦é¨“å‰ã¯é‡ç¯¤ãªå‰¯ä½œç”¨ã‚¤ãƒ™ãƒ³ãƒˆã‚’é™¤å¤–
                    if (!canHaveCriticalEvent) {
                        events = events.filter(e => !e.effects.isCritical);
                    }
                    // é‡ç¯¤ãªå‰¯ä½œç”¨ã®ç™ºç”Ÿç¢ºç‡ã‚’ä¸‹ã’ã‚‹ï¼ˆ10%ã®ç¢ºç‡ï¼‰
                    if (canHaveCriticalEvent && Math.random() > 0.1) {
                        events = events.filter(e => !e.effects.isCritical);
                    }
                } else {
                    events = this.randomEvents.neutral;
                }
                
                const event = events[Math.floor(Math.random() * events.length)];
                this.showEventModal(event, eventType < 0.4 ? 'positive' : eventType < 0.8 ? 'negative' : 'neutral');
            }
            
            showEventModal(event, type) {
                const modal = document.getElementById('event-modal');
                const content = document.getElementById('event-content');
                
                // é‡ç¯¤ãªå‰¯ä½œç”¨ã®å ´åˆã¯ç‰¹åˆ¥ãªå‡¦ç†
                if (event.effects.isCritical) {
                    content.innerHTML = `
                        <div class="event-header">
                            <div class="event-icon">â˜ ï¸</div>
                            <h2 class="event-title" style="color: #d32f2f">${event.title}</h2>
                        </div>
                        <div class="event-description" style="color: #d32f2f">
                            ${event.description}
                        </div>
                        <div class="event-effects" style="background: #ffebee; border: 2px solid #d32f2f;">
                            <h4 style="color: #d32f2f">é‡å¤§ãªå½±éŸ¿ï¼š</h4>
                            <p>è¢«é¨“è€…ã®å®‰å…¨ç¢ºä¿ã®ãŸã‚ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯å³åº§ã«ä¸­æ­¢ã•ã‚Œã¾ã™ã€‚</p>
                            <p>è¦åˆ¶å½“å±€ã¸ã®å ±å‘Šã¨èª¿æŸ»ãŒå¿…è¦ã§ã™ã€‚</p>
                        </div>
                        <button class="btn btn-danger" onclick="game.forceTermination('é‡ç¯¤ãªå‰¯ä½œç”¨')">
                            äº†è§£
                        </button>
                    `;
                    
                    modal.style.display = 'flex';
                    return;
                }
                
                const icon = type === 'positive' ? 'ğŸ‰' : type === 'negative' ? 'âš ï¸' : 'ğŸ“°';
                const color = type === 'positive' ? '#4CAF50' : type === 'negative' ? '#f44336' : '#FF9800';
                
                // é¸æŠè‚¢ã‚’ç”Ÿæˆ
                let actionButtons = '';
                if (type === 'negative' || (type === 'neutral' && event.strategicShift)) {
                    actionButtons = `
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                            <button class="btn btn-primary" onclick="game.applyEventEffects(${JSON.stringify(event.effects).replace(/"/g, '&quot;')})">
                                ç¾çŠ¶ç¶­æŒã§é€²ã‚€
                            </button>
                            <button class="btn btn-warning" onclick="game.requestAdditionalFunding()">
                                è¿½åŠ äºˆç®—ã‚’è¦è«‹
                            </button>
                            <button class="btn btn-danger" onclick="game.reviseStrategy()">
                                æˆ¦ç•¥ã‚’è¦‹ç›´ã™
                            </button>
                            ${this.currentPhase > 0 ? '<button class="btn btn-info" onclick="game.reviewPreviousPhase()" style="background: linear-gradient(135deg, #36D1DC 0%, #5B86E5 100%); color: white;">å‰ãƒ•ã‚§ãƒ¼ã‚ºã‚’è£œå¼·</button>' : ''}
                        </div>
                    `;
                } else {
                    actionButtons = `
                        <button class="btn btn-primary" onclick="game.applyEventEffects(${JSON.stringify(event.effects).replace(/"/g, '&quot;')})">
                            äº†è§£
                        </button>
                    `;
                }
                
                content.innerHTML = `
                    <div class="event-header">
                        <div class="event-icon">${icon}</div>
                        <h2 class="event-title" style="color: ${color}">${event.title}</h2>
                    </div>
                    <div class="event-description">
                        ${event.description}
                    </div>
                    <div class="event-effects">
                        <h4>å½±éŸ¿ï¼š</h4>
                        ${this.renderEventEffects(event.effects)}
                    </div>
                    ${actionButtons}
                `;
                
                modal.style.display = 'flex';
                this.currentEvent = event;
            }
            
            renderEventEffects(effects) {
                let html = '';
                
                if (effects.budget) {
                    const sign = effects.budget > 0 ? '+' : '';
                    const className = effects.budget > 0 ? 'effect-positive' : 'effect-negative';
                    html += `<div class="effect-item">
                        <span>äºˆç®—</span>
                        <span class="${className}">${sign}$${(Math.abs(effects.budget)/1000000).toFixed(1)}M</span>
                    </div>`;
                }
                
                if (effects.successRate) {
                    const sign = effects.successRate > 0 ? '+' : '';
                    const className = effects.successRate > 0 ? 'effect-positive' : 'effect-negative';
                    html += `<div class="effect-item">
                        <span>æˆåŠŸç¢ºç‡</span>
                        <span class="${className}">${sign}${effects.successRate}%</span>
                    </div>`;
                }
                
                if (effects.competitiveness) {
                    const sign = effects.competitiveness > 0 ? '+' : '';
                    const className = effects.competitiveness > 0 ? 'effect-positive' : 'effect-negative';
                    html += `<div class="effect-item">
                        <span>ç«¶äº‰åŠ›</span>
                        <span class="${className}">${sign}${effects.competitiveness}%</span>
                    </div>`;
                }
                
                if (effects.timeBonus) {
                    const text = effects.timeBonus > 0 ? `+${effects.timeBonus}ãƒ¶æœˆ` : `${effects.timeBonus}ãƒ¶æœˆ`;
                    const className = effects.timeBonus < 0 ? 'effect-positive' : 'effect-negative';
                    html += `<div class="effect-item">
                        <span>é–‹ç™ºæœŸé–“</span>
                        <span class="${className}">${text}</span>
                    </div>`;
                }
                
                return html;
            }
            
            applyEventEffects(effects) {
                // æ–°è¦æƒ…å ±å–å¾—ãƒœã‚¿ãƒ³ãƒã‚°å¯¾å¿œ: å¿…ãšãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                document.getElementById('event-modal').style.display = 'none';
                if (effects.budget) {
                    this.budget += effects.budget;
                }
                if (effects.successRate) {
                    this.successRate += effects.successRate;
                }
                if (effects.competitiveness) {
                    this.competitiveness += effects.competitiveness;
                }
                if (effects.timeBonus) {
                    this.months += effects.timeBonus;
                }

                this.successRate = Math.min(Math.max(this.successRate, 0), 95);
                this.competitiveness = Math.min(Math.max(this.competitiveness, 0), 100);

                this.addMessage(effects.message, "event");

                // äºˆç®—ãŒãƒã‚¤ãƒŠã‚¹ã«ãªã£ãŸå ´åˆã®å‡¦ç†
                if (this.budget < 0) {
                    this.budget = 0;
                    this.addMessage("ğŸ’¸ äºˆç®—ãŒå®Œå…¨ã«æ¯æ¸‡ã—ã¾ã—ãŸï¼è³‡é‡‘èª¿é”ãŒå¿…è¦ã§ã™ã€‚", "error");
                    setTimeout(() => this.showResourceOptions(), 500);
                    this.updateStatus();
                    return;
                }

                // æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸
                this.currentPhase++;

                // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ¢ç´¢â†’ãƒªãƒ¼ãƒ‰åŒ–åˆç‰©æ¢ç´¢ãƒã‚°ä¿®æ­£
                if (this.currentPhase >= this.phases.length) {
                    this.gameOver(true);
                } else {
                    this.addMessage(`ğŸ“‹ ${this.phases[this.currentPhase].name}ã‚’é–‹å§‹ã—ã¾ã™ã€‚`, "success");
                    this.renderPhases();
                }

                this.updateStatus();
            }
            
            updateStatus() {
                document.getElementById('budget').textContent = `$${(this.budget/1000000).toFixed(1)}M`;
                document.getElementById('months').textContent = this.months;
                document.getElementById('success-rate').textContent = `${Math.round(this.successRate)}%`;
                document.getElementById('competitiveness').textContent = `${Math.round(this.competitiveness)}%`;
            }
            
            addMessage(message, type = '') {
                const log = document.getElementById('message-log');
                const messageEl = document.createElement('div');
                messageEl.className = `message ${type}`;
                messageEl.textContent = `[${this.months}ãƒ¶æœˆ] ${message}`;
                log.appendChild(messageEl);
                log.scrollTop = log.scrollHeight;
            }
            
            requestAdditionalFunding() {
                const modal = document.getElementById('event-modal');
                const content = document.getElementById('event-content');
                
                const fundingChance = Math.random();
                let result;
                
                if (this.successRate > 50 && fundingChance < 0.7) {
                    // æˆåŠŸ
                    const additionalFunding = 15000000 + Math.floor(Math.random() * 10000000);
                    this.budget += additionalFunding;
                    result = {
                        success: true,
                        message: `âœ… è¿½åŠ äºˆç®—${(additionalFunding/1000000).toFixed(1)}Mã‚’ç²å¾—ã—ã¾ã—ãŸï¼`,
                        description: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é€²æ—ãŒè©•ä¾¡ã•ã‚Œã€æŠ•è³‡å®¶ã‹ã‚‰è¿½åŠ è³‡é‡‘ã‚’èª¿é”ã§ãã¾ã—ãŸã€‚"
                    };
                } else if (fundingChance < 0.3) {
                    // éƒ¨åˆ†çš„æˆåŠŸ
                    const additionalFunding = 5000000;
                    this.budget += additionalFunding;
                    this.successRate -= 5;
                    result = {
                        success: true,
                        message: `âš ï¸ é™å®šçš„ãªè¿½åŠ äºˆç®—${(additionalFunding/1000000).toFixed(1)}Mã‚’ç²å¾—ã€‚`,
                        description: "ä¸€éƒ¨ã®è³‡é‡‘ã¯ç¢ºä¿ã§ãã¾ã—ãŸãŒã€å³ã—ã„æ¡ä»¶ãŒä»˜ã‘ã‚‰ã‚Œã¾ã—ãŸã€‚"
                    };
                } else {
                    // å¤±æ•—
                    this.competitiveness -= 10;
                    this.months += 2;
                    result = {
                        success: false,
                        message: "âŒ è¿½åŠ äºˆç®—ã®è¦è«‹ã¯å´ä¸‹ã•ã‚Œã¾ã—ãŸã€‚",
                        description: "æŠ•è³‡å®¶ã‚’èª¬å¾—ã§ããšã€æ™‚é–“ã¨ä¿¡ç”¨ã‚’å¤±ã„ã¾ã—ãŸã€‚"
                    };
                }
                
                content.innerHTML = `
                    <div class="event-header">
                        <div class="event-icon">${result.success ? 'ğŸ’°' : 'ğŸ˜”'}</div>
                        <h2 class="event-title">${result.success ? 'è³‡é‡‘èª¿é”çµæœ' : 'è³‡é‡‘èª¿é”å¤±æ•—'}</h2>
                    </div>
                    <div class="event-description">
                        ${result.description}
                    </div>
                    <button class="btn btn-primary" onclick="game.closeModalAndContinue('${result.message}')">
                        ç¶šã‘ã‚‹
                    </button>
                `;
            }
            
            reviseStrategy() {
                const modal = document.getElementById('event-modal');
                const content = document.getElementById('event-content');
                
                const strategicOptions = [
                    {
                        name: "ãƒ”ãƒœãƒƒãƒˆæˆ¦ç•¥",
                        description: "é–‹ç™ºæ–¹é‡ã‚’å¤§å¹…ã«å¤‰æ›´ã—ã€åˆ¥ã®é©å¿œç—‡ã‚’ç‹™ã„ã¾ã™",
                        effects: {
                            successRate: -10,
                            competitiveness: 20,
                            months: 6,
                            message: "ğŸ”„ æˆ¦ç•¥ã‚’è»¢æ›ã—ã€æ–°ãŸãªå¸‚å ´æ©Ÿä¼šã‚’ç‹™ã„ã¾ã™ã€‚"
                        }
                    },
                    {
                        name: "ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—",
                        description: "ä»–ç¤¾ã¨ææºã—ã¦é–‹ç™ºãƒªã‚¹ã‚¯ã‚’åˆ†æ•£ã—ã¾ã™",
                        effects: {
                            budget: 20000000,
                            successRate: 5,
                            competitiveness: -15,
                            message: "ğŸ¤ æˆ¦ç•¥çš„ææºã«ã‚ˆã‚Šè³‡é‡‘ã‚’ç¢ºä¿ã—ã¾ã—ãŸã€‚"
                        }
                    },
                    {
                        name: "ãƒ•ã‚§ãƒ¼ã‚ºå†è©•ä¾¡",
                        description: "ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚ºã‚’å†åº¦ç²¾æŸ»ã—ã€åŠ¹ç‡åŒ–ã‚’å›³ã‚Šã¾ã™",
                        effects: {
                            successRate: 15,
                            months: -3,
                            budget: -5000000,
                            message: "ğŸ“Š è©³ç´°ãªå†è©•ä¾¡ã«ã‚ˆã‚Šé–‹ç™ºã‚’æœ€é©åŒ–ã—ã¾ã—ãŸã€‚"
                        }
                    }
                ];
                
                let optionsHtml = '';
                strategicOptions.forEach((option, index) => {
                    optionsHtml += `
                        <div class="action-card" style="margin-bottom: 10px;">
                            <h4>${option.name}</h4>
                            <p style="font-size: 0.9em; color: #666;">${option.description}</p>
                            <button class="btn btn-warning" onclick="game.applyStrategicChoice(${index})">
                                ã“ã®æˆ¦ç•¥ã‚’é¸æŠ
                            </button>
                        </div>
                    `;
                });
                
                content.innerHTML = `
                    <div class="event-header">
                        <div class="event-icon">ğŸ¯</div>
                        <h2 class="event-title">æˆ¦ç•¥ã®è¦‹ç›´ã—</h2>
                    </div>
                    <div class="event-description">
                        ç¾åœ¨ã®çŠ¶æ³ã‚’è¸ã¾ãˆã€ä»¥ä¸‹ã®æˆ¦ç•¥ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„ï¼š
                    </div>
                    ${optionsHtml}
                `;
                
                this.strategicOptions = strategicOptions;
            }
            
            applyStrategicChoice(index) {
                const choice = this.strategicOptions[index];
                const effects = choice.effects;
                
                // åŠ¹æœã‚’é©ç”¨
                if (effects.budget) this.budget += effects.budget;
                if (effects.successRate) this.successRate += effects.successRate;
                if (effects.competitiveness) this.competitiveness += effects.competitiveness;
                if (effects.months) this.months += effects.months;
                
                this.successRate = Math.min(Math.max(this.successRate, 0), 95);
                this.competitiveness = Math.min(Math.max(this.competitiveness, 0), 100);
                
                this.closeModalAndContinue(effects.message);
            }
            
            closeModalAndContinue(message) {
                document.getElementById('event-modal').style.display = 'none';
                this.addMessage(message, "event");
                
                // å…ƒã®ã‚¤ãƒ™ãƒ³ãƒˆã®åŸºæœ¬åŠ¹æœã‚‚é©ç”¨
                if (this.currentEvent && this.currentEvent.effects) {
                    const effects = this.currentEvent.effects;
                    if (effects.budget) this.budget += effects.budget;
                    if (effects.successRate) this.successRate += effects.successRate;
                    if (effects.competitiveness) this.competitiveness += effects.competitiveness;
                    if (effects.timeBonus) this.months += effects.timeBonus;
                }
                
                this.successRate = Math.min(Math.max(this.successRate, 0), 95);
                this.competitiveness = Math.min(Math.max(this.competitiveness, 0), 100);
                
                // æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸
                this.currentPhase++;
                
                if (this.currentPhase >= this.phases.length) {
                    this.gameOver(true);
                } else {
                    this.addMessage(`ğŸ“‹ ${this.phases[this.currentPhase].name}ã‚’é–‹å§‹ã—ã¾ã™ã€‚`, "success");
                    this.renderPhases();
                }
                
                this.updateStatus();
                this.currentEvent = null;
            }
            
            reviewPreviousPhase() {
                const modal = document.getElementById('event-modal');
                const content = document.getElementById('event-content');
                
                const previousPhase = this.phases[this.currentPhase - 1];
                const reviewCost = 8000000;
                
                if (this.budget < reviewCost) {
                    content.innerHTML = `
                        <div class="event-header">
                            <div class="event-icon">ğŸ’¸</div>
                            <h2 class="event-title">äºˆç®—ä¸è¶³</h2>
                        </div>
                        <div class="event-description">
                            å‰ãƒ•ã‚§ãƒ¼ã‚ºã®è£œå¼·ã«ã¯${(reviewCost/1000000).toFixed(1)}MãŒå¿…è¦ã§ã™ãŒã€äºˆç®—ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚
                        </div>
                        <button class="btn btn-primary" onclick="game.showEventModal(game.currentEvent, 'negative')">
                            æˆ»ã‚‹
                        </button>
                    `;
                    return;
                }
                
                content.innerHTML = `
                    <div class="event-header">
                        <div class="event-icon">ğŸ”</div>
                        <h2 class="event-title">${previousPhase.name}ã®è£œå¼·</h2>
                    </div>
                    <div class="event-description">
                        <p>å‰ãƒ•ã‚§ãƒ¼ã‚ºã§å¾—ã‚‰ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å†è§£æã—ã€è¿½åŠ å®Ÿé¨“ã‚’è¡Œã†ã“ã¨ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åŸºç›¤ã‚’å¼·åŒ–ã§ãã¾ã™ã€‚</p>
                        <div class="event-effects" style="margin-top: 15px;">
                            <h4>å¿…è¦ã‚³ã‚¹ãƒˆï¼š${(reviewCost/1000000).toFixed(1)}M</h4>
                            <h4>æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœï¼š</h4>
                            <div class="effect-item">
                                <span>æˆåŠŸç¢ºç‡</span>
                                <span class="effect-positive">+8ã€œ15%</span>
                            </div>
                            <div class="effect-item">
                                <span>è¿½åŠ æœŸé–“</span>
                                <span class="effect-negative">+2ãƒ¶æœˆ</span>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="game.executePhaseReview()">
                            è£œå¼·ã‚’å®Ÿæ–½
                        </button>
                        <button class="btn btn-warning" onclick="game.showEventModal(game.currentEvent, 'negative')">
                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </button>
                    </div>
                `;
            }
            
            executePhaseReview() {
                const reviewCost = 8000000;
                this.budget -= reviewCost;
                this.months += 2;
                
                const successBonus = 8 + Math.floor(Math.random() * 8);
                this.successRate += successBonus;
                
                const message = `ğŸ“ˆ å‰ãƒ•ã‚§ãƒ¼ã‚ºã®è£œå¼·ã«ã‚ˆã‚Šã€æˆåŠŸç¢ºç‡ãŒ${successBonus}%å‘ä¸Šã—ã¾ã—ãŸï¼`;
                
                this.successRate = Math.min(this.successRate, 95);
                this.closeModalAndContinue(message);
            }
            
            executeAdditionalWork(phaseIndex) {
                const phase = this.phases[phaseIndex];
                const additionalCost = 3000000;
                
                if (this.budget < additionalCost) {
                    this.addMessage("âŒ è¿½åŠ å®Ÿé¨“ã®äºˆç®—ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚", "error");
                    return;
                }
                
                this.budget -= additionalCost;
                this.totalSpent += additionalCost;
                this.months += 2;
                
                // è¿½åŠ å®Ÿé¨“ã§æ®‹ã‚Šã®é€²æ—ã‚’å®Œäº†
                const remainingProgress = 100 - phase.progress;
                phase.progress = 100;
                
                this.addMessage(`âœ… è¿½åŠ å®Ÿé¨“ã«ã‚ˆã‚Š${phase.name}ã‚’å®Œäº†ã—ã¾ã—ãŸï¼`, "success");
                
                this.updateStatus();
                this.renderPhases();
            }
            
            showResourceOptions() {
                const modal = document.getElementById('event-modal');
                const content = document.getElementById('event-content');
                
                const currentPhase = this.phases[this.currentPhase];
                const minRequired = Math.min(...currentPhase.actions
                    .filter((a, idx) => !currentPhase.executedActions || !currentPhase.executedActions.includes(idx))
                    .map(a => a.cost));
                
                content.innerHTML = `
                    <div class="event-header">
                        <div class="event-icon">ğŸ’¸</div>
                        <h2 class="event-title">è³‡é‡‘èª¿é”ã‚ªãƒ—ã‚·ãƒ§ãƒ³</h2>
                    </div>
                    <div class="event-description">
                        <p>ç¾åœ¨ã®äºˆç®—: ${(this.budget/1000000).toFixed(1)}M</p>
                        <p>æœ€ä½å¿…è¦é¡: ${(minRequired/1000000).toFixed(1)}M</p>
                        <p>ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„ï¼š</p>
                    </div>
                    <div style="margin-top: 20px;">
                        <div class="action-card" style="margin-bottom: 15px;">
                            <h4>ç·Šæ€¥è³‡é‡‘èª¿é”</h4>
                            <p>æŠ•è³‡å®¶ã«ç·Šæ€¥ã‚¢ãƒ”ãƒ¼ãƒ«ã€‚æˆåŠŸç‡ã¯ç¾åœ¨ã®é€²æ—ã«ä¾å­˜ã€‚</p>
                            <button class="btn btn-warning" onclick="game.emergencyFunding()">
                                å®Ÿè¡Œï¼ˆæˆåŠŸç‡: ${Math.round(this.successRate * 0.8)}%ï¼‰
                            </button>
                        </div>
                        <div class="action-card" style="margin-bottom: 15px;">
                            <h4>ã‚¢ã‚»ãƒƒãƒˆå£²å´</h4>
                            <p>ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¨©åˆ©ã‚’å£²å´ã€‚ç¢ºå®Ÿã«è³‡é‡‘ã‚’å¾—ã‚‹ãŒç«¶äº‰åŠ›ãŒä½ä¸‹ã€‚</p>
                            <button class="btn btn-danger" onclick="game.sellAssets()">
                                å®Ÿè¡Œï¼ˆ$10Mç²å¾—ã€ç«¶äº‰åŠ›-20%ï¼‰
                            </button>
                        </div>
                        <div class="action-card">
                            <h4>å…±åŒé–‹ç™ºææ¡ˆ</h4>
                            <p>ç«¶åˆä»–ç¤¾ã¨ã®å…±åŒé–‹ç™ºã€‚å¤§ããªè³‡é‡‘ã‚’å¾—ã‚‹ãŒä¸»å°æ¨©ã‚’ä¸€éƒ¨å¤±ã†ã€‚</p>
                            <button class="btn btn-info" onclick="game.jointDevelopment()">
                                å®Ÿè¡Œï¼ˆ$25Mç²å¾—ã€ç«¶äº‰åŠ›-30%ã€æˆåŠŸç‡+10%ï¼‰
                            </button>
                        </div>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 20px;" onclick="document.getElementById('event-modal').style.display='none'">
                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    </button>
                `;
                
                modal.style.display = 'flex';
            }
            
            emergencyFunding() {
                const successChance = this.successRate * 0.8 / 100;
                if (Math.random() < successChance) {
                    const funding = 15000000 + Math.floor(Math.random() * 10000000);
                    this.budget += funding;
                    this.addMessage(`âœ… ç·Šæ€¥è³‡é‡‘èª¿é”æˆåŠŸï¼${(funding/1000000).toFixed(1)}Mã‚’ç²å¾—ã—ã¾ã—ãŸã€‚`, "success");
                } else {
                    this.months += 3;
                    this.competitiveness -= 5;
                    this.addMessage("âŒ ç·Šæ€¥è³‡é‡‘èª¿é”ã«å¤±æ•—ã€‚æ™‚é–“ã¨ä¿¡ç”¨ã‚’å¤±ã„ã¾ã—ãŸã€‚", "error");
                }
                document.getElementById('event-modal').style.display = 'none';
                this.updateStatus();
                this.renderPhases();
            }
            
            sellAssets() {
                this.budget += 10000000;
                this.competitiveness -= 20;
                this.competitiveness = Math.max(this.competitiveness, 0);
                this.addMessage("ğŸ’° ã‚¢ã‚»ãƒƒãƒˆå£²å´ã«ã‚ˆã‚Š$10Mã‚’ç²å¾—ã€‚ç«¶äº‰åŠ›ãŒä½ä¸‹ã—ã¾ã—ãŸã€‚", "warning");
                document.getElementById('event-modal').style.display = 'none';
                this.updateStatus();
                this.renderPhases();
            }
            
            jointDevelopment() {
                this.budget += 25000000;
                this.competitiveness -= 30;
                this.successRate += 10;
                this.competitiveness = Math.max(this.competitiveness, 0);
                this.successRate = Math.min(this.successRate, 95);
                this.addMessage("ğŸ¤ å…±åŒé–‹ç™ºå¥‘ç´„ç· çµã€‚$25Mã‚’ç²å¾—ã—ã¾ã—ãŸãŒã€ä¸»å°æ¨©ã®ä¸€éƒ¨ã‚’å¤±ã„ã¾ã—ãŸã€‚", "warning");
                document.getElementById('event-modal').style.display = 'none';
                this.updateStatus();
                this.renderPhases();
            }
            
            returnToPreviousPhase() {
                if (this.currentPhase === 0) return;
                
                const modal = document.getElementById('event-modal');
                const content = document.getElementById('event-content');
                
                content.innerHTML = `
                    <div class="event-header">
                        <div class="event-icon">âª</div>
                        <h2 class="event-title">å‰ãƒ•ã‚§ãƒ¼ã‚ºã¸ã®å¾©å¸°</h2>
                    </div>
                    <div class="event-description">
                        <p>å‰ã®ãƒ•ã‚§ãƒ¼ã‚ºã€Œ${this.phases[this.currentPhase - 1].name}ã€ã«æˆ»ã£ã¦è¿½åŠ ã®ä½œæ¥­ã‚’è¡Œã„ã¾ã™ã€‚</p>
                        <p style="color: #f44336; margin-top: 10px;">
                            <strong>æ³¨æ„ï¼š</strong>ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚ºã®é€²æ—ã¯å¤±ã‚ã‚Œã€æ™‚é–“ã‚‚çµŒéã—ã¾ã™ã€‚
                        </p>
                    </div>
                    <div class="event-effects">
                        <h4>å½±éŸ¿ï¼š</h4>
                        <div class="effect-item">
                            <span>ç¾ãƒ•ã‚§ãƒ¼ã‚ºé€²æ—</span>
                            <span class="effect-negative">ãƒªã‚»ãƒƒãƒˆ</span>
                        </div>
                        <div class="effect-item">
                            <span>è¿½åŠ æ™‚é–“</span>
                            <span class="effect-negative">+3ãƒ¶æœˆ</span>
                        </div>
                        <div class="effect-item">
                            <span>ä¿¡é ¼æ€§</span>
                            <span class="effect-negative">-5%</span>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-danger" onclick="game.executePreviousPhaseReturn()">
                            å‰ãƒ•ã‚§ãƒ¼ã‚ºã«æˆ»ã‚‹
                        </button>
                        <button class="btn btn-primary" onclick="document.getElementById('event-modal').style.display='none'">
                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </button>
                    </div>
                `;
                
                modal.style.display = 'flex';
            }
            
            executePreviousPhaseReturn() {
                // ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚ºã‚’ãƒªã‚»ãƒƒãƒˆ
                const currentPhase = this.phases[this.currentPhase];
                currentPhase.progress = 0;
                currentPhase.executedActions = [];
                
                // ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’é©ç”¨
                this.months += 3;
                this.successRate -= 5;
                this.successRate = Math.max(this.successRate, 0);
                
                // å‰ã®ãƒ•ã‚§ãƒ¼ã‚ºã«æˆ»ã‚‹
                this.currentPhase--;
                this.phases[this.currentPhase].progress = 0;
                this.phases[this.currentPhase].executedActions = [];
                
                this.addMessage("âª å‰ã®ãƒ•ã‚§ãƒ¼ã‚ºã«æˆ»ã‚Šã¾ã—ãŸã€‚è¿½åŠ ã®ä½œæ¥­ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚", "warning");
                
                document.getElementById('event-modal').style.display = 'none';
                this.updateStatus();
                this.renderPhases();
            }
            
            strategicTermination() {
                const modal = document.getElementById('event-modal');
                const content = document.getElementById('event-content');
                
                const salvageValue = Math.floor(this.successRate / 100 * 20000000);
                
                content.innerHTML = `
                    <div class="event-header">
                        <div class="event-icon">ğŸ›‘</div>
                        <h2 class="event-title">æˆ¦ç•¥çš„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸­æ­¢</h2>
                    </div>
                    <div class="event-description">
                        <p>ã“ã‚Œä»¥ä¸Šã®æŠ•è³‡ã¯ãƒªã‚¹ã‚¯ãŒé«˜ã™ãã‚‹ã¨åˆ¤æ–­ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸­æ­¢ã—ã¾ã™ã€‚</p>
                        <p>ã“ã‚Œã¾ã§ã®ç ”ç©¶æˆæœã‚’ä»–ç¤¾ã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã™ã‚‹ã“ã¨ã§ã€ä¸€éƒ¨ã®æŠ•è³‡ã‚’å›åã§ãã¾ã™ã€‚</p>
                    </div>
                    <div class="event-effects">
                        <h4>æœ€çµ‚çµæœï¼š</h4>
                        <div class="effect-item">
                            <span>é–‹ç™ºæœŸé–“</span>
                            <span>${this.months}ãƒ¶æœˆ</span>
                        </div>
                        <div class="effect-item">
                            <span>ç·æŠ•è³‡é¡</span>
                            <span>${(this.totalSpent/1000000).toFixed(1)}M</span>
                        </div>
                        <div class="effect-item">
                            <span>å›åå¯èƒ½é¡</span>
                            <span class="effect-positive">${(salvageValue/1000000).toFixed(1)}M</span>
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="game.executeTermination(${salvageValue})">
                        ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸­æ­¢
                    </button>
                `;
                
                modal.style.display = 'flex';
            }
            
            executeTermination(salvageValue) {
                const container = document.getElementById('phases-container');
                const terminationEl = document.createElement('div');
                terminationEl.className = 'game-over';
                terminationEl.style.background = 'linear-gradient(135deg, #FF9800 0%, #F44336 100%)';
                
                terminationEl.innerHTML = `
                    <h2>ğŸ æˆ¦ç•¥çš„æ’¤é€€</h2>
                    <p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸­æ­¢ã—ã¾ã—ãŸã€‚</p>
                    <p>é–‹ç™ºæœŸé–“: ${this.months}ãƒ¶æœˆ</p>
                    <p>åˆ°é”ãƒ•ã‚§ãƒ¼ã‚º: ${this.phases[this.currentPhase].name}</p>
                    <p>ç·æŠ•è³‡é¡: ${(this.totalSpent/1000000).toFixed(1)}M</p>
                    <p>å›åé¡: ${(salvageValue/1000000).toFixed(1)}M</p>
                    <p>ç´”æå¤±: ${((this.totalSpent - salvageValue)/1000000).toFixed(1)}M</p>
                    <p style="margin-top: 20px;">å¤±æ•—ã‚‚è²´é‡ãªçµŒé¨“ã§ã™ã€‚æ¬¡å›ã¯ã‚ˆã‚Šè‰¯ã„æˆ¦ç•¥ã§æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ï¼</p>
                    <button class="btn btn-warning restart-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
                `;
                
                container.innerHTML = '';
                container.appendChild(terminationEl);
                document.getElementById('event-modal').style.display = 'none';
            }
            
            forceTermination(reason) {
                const container = document.getElementById('phases-container');
                const terminationEl = document.createElement('div');
                terminationEl.className = 'game-over';
                terminationEl.style.background = 'linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%)';
                
                let reasonText = '';
                switch(reason) {
                    case 'è³‡é‡‘èª¿é”å¤±æ•—':
                        reasonText = 'ç·Šæ€¥è³‡é‡‘èª¿é”ã«å¤±æ•—ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç¶™ç¶šãŒä¸å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚';
                        break;
                    case 'é‡ç¯¤ãªå‰¯ä½œç”¨':
                        reasonText = 'é‡ç¯¤ãªå‰¯ä½œç”¨ãŒç™ºç”Ÿã—ã€è¦åˆ¶å½“å±€ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸­æ­¢å‘½ä»¤ãŒå‡ºã•ã‚Œã¾ã—ãŸã€‚';
                        break;
                    case 'ãƒªã‚½ãƒ¼ã‚¹æ¯æ¸‡':
                        reasonText = 'åˆ©ç”¨å¯èƒ½ãªã™ã¹ã¦ã®è³‡é‡‘èª¿é”æ‰‹æ®µãŒå°½ãã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç¶™ç¶šãŒä¸å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚';
                        break;
                    default:
                        reasonText = 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¶™ç¶šãŒä¸å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚';
                }
                
                terminationEl.innerHTML = `
                    <h2>ğŸ’” ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå¼·åˆ¶çµ‚äº†</h2>
                    <p style="font-size: 1.2em; margin: 20px 0;">${reasonText}</p>
                    <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <p><strong>æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆ</strong></p>
                        <p>é–‹ç™ºæœŸé–“: ${this.months}ãƒ¶æœˆ</p>
                        <p>åˆ°é”ãƒ•ã‚§ãƒ¼ã‚º: ${this.phases[this.currentPhase].name}</p>
                        <p>ç·æŠ•è³‡é¡: ${(this.totalSpent/1000000).toFixed(1)}M</p>
                        <p>æœ€çµ‚æˆåŠŸç¢ºç‡: ${Math.round(this.successRate)}%</p>
                        <p>å¸‚å ´ç«¶äº‰åŠ›: ${Math.round(this.competitiveness)}%</p>
                    </div>
                    <p>å‰µè–¬é–‹ç™ºã®å³ã—ã„ç¾å®Ÿã‚’çµŒé¨“ã—ã¾ã—ãŸã€‚æ¬¡å›ã¯ã‚ˆã‚Šæ…é‡ãªæˆ¦ç•¥ã§æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ã€‚</p>
                    <button class="btn restart-btn" style="background: #ff5252; margin-top: 20px;" onclick="location.reload()">
                        æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹
                    </button>
                `;
                
                container.innerHTML = '';
                container.appendChild(terminationEl);
                
                // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ­ã‚°ã‚‚ã‚¯ãƒªã‚¢
                const messageLog = document.getElementById('message-log');
                messageLog.innerHTML = `<div class="message error">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå¼·åˆ¶çµ‚äº†ã•ã‚Œã¾ã—ãŸ: ${reason}</div>`;
            }
            
            gameOver(success) {
                const container = document.getElementById('phases-container');
                const gameOverEl = document.createElement('div');
                gameOverEl.className = 'game-over';
                
                if (success) {
                    const finalScore = (this.successRate * 0.6 + this.competitiveness * 0.4);
                    const finalSuccess = Math.random() * 100 < finalScore;
                    
                    if (finalSuccess) {
                        gameOverEl.innerHTML = `
                            <h2>ğŸŠ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</h2>
                            <p>æ–°è–¬ã®é–‹ç™ºã«æˆåŠŸã—ã¾ã—ãŸï¼</p>
                            <p>é–‹ç™ºæœŸé–“: ${this.months}ãƒ¶æœˆ</p>
                            <p>ç·é–‹ç™ºè²»: $${(this.totalSpent/1000000).toFixed(1)}M</p>
                            <p>æ®‹ã‚Šäºˆç®—: $${(this.budget/1000000).toFixed(1)}M</p>
                            <p>æœ€çµ‚æˆåŠŸç¢ºç‡: ${Math.round(this.successRate)}%</p>
                            <p>å¸‚å ´ç«¶äº‰åŠ›: ${Math.round(this.competitiveness)}%</p>
                            <button class="btn btn-success restart-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
                        `;
                    } else {
                        gameOverEl.innerHTML = `
                            <h2>ğŸ˜¢ æƒœã—ã„ï¼</h2>
                            <p>æœ€çµ‚æ‰¿èªã§å´ä¸‹ã•ã‚Œã¾ã—ãŸã€‚</p>
                            <p>æˆåŠŸç¢ºç‡${Math.round(this.successRate)}%ã€ç«¶äº‰åŠ›${Math.round(this.competitiveness)}%ã§ã—ãŸãŒã€æ‰¿èªåŸºæº–ã‚’æº€ãŸã›ã¾ã›ã‚“ã§ã—ãŸã€‚</p>
                            <button class="btn btn-warning restart-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>
                        `;
                    }
                } else {
                    gameOverEl.innerHTML = `
                        <h2>ğŸ’¸ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</h2>
                        <p>äºˆç®—ãŒå°½ãã¦ã—ã¾ã„ã¾ã—ãŸ...</p>
                        <p>é–‹ç™ºæœŸé–“: ${this.months}ãƒ¶æœˆ</p>
                        <p>åˆ°é”ãƒ•ã‚§ãƒ¼ã‚º: ${this.phases[this.currentPhase].name}</p>
                        <button class="btn btn-warning restart-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
                    `;
                }
                
                container.appendChild(gameOverEl);
            }
        }
        
        // ã‚²ãƒ¼ãƒ é–‹å§‹
        const game = new DrugDiscoveryGame();
    </script>
</body>
</html>
